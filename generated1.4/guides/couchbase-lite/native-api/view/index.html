<!DOCTYPE html>
<html>

<head>

  <meta name="description" content="A high-level introduction to the component parts of the Couchbase Mobile product." />
  <meta name="version" content="1.4" />
  <meta name="product" content="mobile" />
  

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MVPNN2');</script>
  <!-- End Google Tag Manager -->
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <link rel="shortcut icon" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon.ico" type="image/x-icon">
  <link rel="icon" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"Â  href="/webfiles/1498186094252/images/icons/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/favicon-16x16.png">
  <link rel="manifest" href="https://developer.couchbase.com/webfiles/1498186094252/images/icons/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/webfiles/1498186094252/images/icons/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!--    _____________________________
  _______/ Support for legacy browsers \_______________________________________-->
  <!--[if lte IE 8]>
  <script type="text/javascript" charset="utf-8" src="/webfiles/1498186094252/js/thirdparty/vendor/html5shiv.js" />
  <script type="text/javascript" charset="utf-8" src="/webfiles/1498186094252/js/thirdparty/vendor/respond.js" />
  <![endif]-->
  <!--[if IE 9]>
  <script type="text/javascript" charset="utf-8" src="/webfiles/1498186094252/js/thirdparty/classList.js" />
  <![endif]-->
  <!--_________________________________________________________________________-->
  <script type="text/javascript" charset="utf-8" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/jquery-migrate.js"></script>
  <script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/slick.js"></script>
  <script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/isotope.min.js"></script>
  <script type="text/javascript" charset="utf-8" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/imagesloaded.min.js"></script>

  <meta name="apple-mobile-web-app-title" content="Couchbase">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="1gPO0RaMzKyZJFpS-iyIEnPsWDztwZH0R3vG1VpSwvM" />

  <!-- LOCAL CSS Libs -->
  <link rel="stylesheet" href="https://developer.couchbase.com/webfiles/1498186094252/css/styles.css">

  <!-- Default canonical comes from the URL -->
  <link rel="canonical" href="http://developer.couchbase.com"/>
  <title>Couchbase</title>
  <link rel="stylesheet" href="https://developer.couchbase.com/binaries/content/assets/css/overrides.css">
</head>

<body>

<!-- Google Tag Manager -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0"
          width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager -->
<script>
  var overrideJsPath = "/binaries/content/assets/js/overrides.js";
  $.ajax({
    url: overrideJsPath,
    type: 'HEAD',
    error: function () {
    },
    success: function () {
      // file exists
      $.getScript(overrideJsPath);
    }
  });
</script>
<!--    ________________
_______/ INCLUDE HEADER - BODY - FOOTER \____________________________________________________-->
<!-- begin - include ref= -->
<nav class="aux">
  <div>
  </div>
</nav>
<!-- Beginning of site.../jsp/base/header.jsp -->
<header id="global-header" class="global-header dev-portal">
  <div class="layout-wrapper">
    <div class="global-header__logo">
      <a href='http://www.couchbase.com'>Couchbase</a>
      <a href='index.html'>Developer</a>

    </div>

    <a data-modules="navigation,globalheadersearch"></a>
    <nav role="navigation" id="primary-navigation" class="primary-navigation">
      <button aria-controls="primary-navigation__wrapper"
              aria-pressed="false"
              class="primary-navigation__toggler"
              type="button">

        <span>Menu</span>
      </button>
      <div id="primary-navigation__wrapper"
           class="primary-navigation__wrapper"
           aria-expanded="false">

        <ul class="primary-navigation__items">
          <li class="primary-navigation__item ">

            <a href="https://developer.couchbase.com/documentation/server/current/introduction/intro.html">Server</a>
          </li>
          <li class="primary-navigation__item ">

            <a href="https://developer.couchbase.com/mobile">Mobile</a>
          </li>
          <li class="primary-navigation__item has-secondary-navigation">

            <a href="https://developer.couchbase.com/community">Community</a>
            <div class="secondary-navigation">
              <ul class="secondary-navigation__items">
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/open-source-projects">Open Source Projects</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/contribute">Contribute</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="http://www.couchbase.com/nosql-resources/events">Events</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/experts-and-champions">Experts &amp; Champions</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="http://forums.couchbase.com/">Forums</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="http://blog.couchbase.com">Blogs</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/support">Support</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="primary-navigation__item has-secondary-navigation">

            <a href="https://developer.couchbase.com/guides-and-references">Site Map</a>
            <div class="secondary-navigation">
              <ul class="secondary-navigation__items">
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#section-1">Couchbase Server</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#section-2">Couchbase Mobile</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#subsection-1-3">SDKs</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/guides-and-references#subsection-1-5">Connectors</a>
                </li>
                <li class="secondary-navigation__item">
                  <a href="https://developer.couchbase.com/documentation-archive">Documentation Archive</a>
                </li>
              </ul>
            </div>
          </li>
        </ul>
        <form id="global-header-search"
              autocomplete="off"
              class="global-header-search global-header-search--js"
              action="https://developer.couchbase.com/search"
              aria-expanded="false">
          <ul><!--
            ---><li>
            <label for="global-header-search__query">
              Search query
            </label>
            <input
                    type="search"
                    placeholder="Search"
                    name="q"
                    value=""
                    id="global-header-search__query">
          </li><!--
                ---><li>
            <button type="submit">
              <span>Search</span>
            </button>
          </li><!--
        ---></ul>
          <button aria-controls="global-header-search__items"
                  aria-pressed="false"
                  class="global-header-search__toggler"
                  type="button">
            <span>Search</span>
          </button><!--
        --->

          <div style="display: none" about="custom-search-fields">

            <input type="hidden"
                   name="cx"
                   value="017928787631531434501:3e7lwhjxsom" />
            <input type="hidden"
                   name="cof"
                   value="FORID:11" />
            <input type="hidden"
                   name="safe"
                   value="off" />
            <input type="hidden"
                   name="form_build_id"
                   value="form-RrbKDUhO3kB2MiqBdZHIQI9L4LFE7c3L_s87N2B9BZo" />
            <input type="hidden"
                   name="form_id"
                   value="google_cse_results_searchbox_form" />
            <input type="hidden"
                   name="siteurl"
                   value='developer.couchbase.com' />

          </div>
        </form>
      </div>
    </nav>
    <a class="global-header__download-button" href="https://developer.couchbase.com/downloads">
      Download
    </a>
  </div>
</header>

<div class="page-content">
  <div class="wrapper">
    <main id="global-content" class="global-content" role="main">

  <div id="page-template-attributes" data-template-id="" data-template-class="learn-support-sec article-tpl"></div>

  <!-- LEFTNAV and ARTICLE -->
  <section class="tpl-body">
    <div class="wrapper">
      <div class="cols">
        <aside class="col one-fifth section-nav left-rail">
          <nav role="navigation" aria-label="Secondary" style="width: 100%;">
            <div class="toc collapsible" style="display: block;">
              



<!-- Used in the left nav to find the relative URL -->




<nav style="width: 100%;" role="navigation" aria-label="Secondary" class="toc collapsible">
  <ul class="main collapsed">
    
      <li class="isexpanded open ">
      
        
          <a href="../../../../whatsnew.html">What's new</a>
        
      
      
      </li>
    
      <li class=" ishidden">
      
        <a href="#" class="static">Hidden Files For Redirects</a>
      
      
        <ul>
          
          <li class=" ">
            
              
                <a href="../../../../guides/sync-gateway/views/index.html">Creating and querying a View</a>
              
            
            
          </li>
          
        </ul>
      
      </li>
    
      <li class="isexpanded open ">
      
        
          <a href="../../../../installation/index.html">Getting Started</a>
        
      
      
        <ul>
          
          <li class=" ">
            
              
                <a href="../../../../installation/ios/index.html">iOS/tvOS/macOS</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../installation/android/index.html">Android</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../installation/net/index.html">.NET</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../installation/xamarin/index.html">Xamarin</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../installation/java/index.html">Java</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../installation/phonegap/index.html">PhoneGap</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../installation/sync-gateway/index.html">Sync Gateway</a>
              
            
            
          </li>
          
        </ul>
      
      </li>
    
      <li class=" ">
      
        
          <a href="../../../../training/index.html">Tutorial</a>
        
      
      
        <ul>
          
          <li class=" ">
            
              <a href="#" class="static">Design</a>
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/design/data-modeling/index.html">Data Modeling</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/design/security/index.html">Access Control</a>
                  
                
                
              </li>
              
            </ul>
            
          </li>
          
          <li class=" ">
            
              <a href="#" class="static">Develop</a>
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/develop/create-database/index.html">Create a Database</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/develop/using-the-database/index.html">Using the Database</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/develop/adding-synchronization/index.html">Adding Sync</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/develop/adding-security/index.html">Adding Security</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/develop/integration/index.html">Integration</a>
                  
                
                
              </li>
              
            </ul>
            
          </li>
          
          <li class=" ">
            
              <a href="#" class="static">Deploy</a>
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/deploy/install/index.html">Install</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/deploy/upgrade/index.html">Upgrade</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../training/deploy/scale/index.html">Scale</a>
                  
                
                
              </li>
              
            </ul>
            
          </li>
          
        </ul>
      
      </li>
    
      <li class="isexpanded open ">
      
        
          <a href="../../../../guides/index.html">Guides</a>
        
      
      
        <ul>
          
          <li class=" ">
            
              
                <a href="../../../../guides/couchbase-lite/native-api/data-modeling/index.html">Data Modeling</a>
              
            
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../guides/couchbase-lite/index.html">Couchbase Lite</a>
              
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/couchbase-lite/native-api/index.html">Native API</a>
                  
                
                
                <ul>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/manager/index.html">Manager</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/database/index.html">Database</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/document/index.html">Document</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/revision/index.html">Revision</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/attachment/index.html">Attachment</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a class="selected" href="../../../../guides/couchbase-lite/native-api/view/index.html">View</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/query/index.html">Query</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/replication/index.html">Replication</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/peer-to-peer/index.html">Peer-to-peer</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/native-api/model/index.html">Model (iOS only)</a>
                      
                    
                    
                  </li>
                  
                </ul>
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/couchbase-lite/tech-notes/index.html">Technical Notes</a>
                  
                
                
                <ul>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/couchbase-lite/tech-notes/cbl-encryption/index.html">Encrypting Databases</a>
                      
                    
                    
                  </li>
                  
                </ul>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../guides/sync-gateway/index.html">Sync Gateway</a>
              
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/config-properties/index.html">Configuration file</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/command-line-options/index.html">Command line options</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/authorizing-users/index.html">Authorizing Users</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/channels/index.html">Data Routing</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/sync-function-api-guide/index.html">Sync Function API</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/server-integration/index.html">Webhooks and changes feed</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/deployment/index.html">Deployment considerations</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/upgrade/index.html">Upgrade</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/nginx/index.html">Load Balancer</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/database-offline/index.html">Taking databases offline and online</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/os-level-tuning/index.html">OS Level Tuning</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/resolving-conflicts/index.html">Resolving Conflicts</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/integrating-external-stores/index.html">Integrating External Stores</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/running-replications/index.html">Running replications</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/rest-api-client/index.html">REST API Client</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/sgcollect-info/index.html">SGCollect Info</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/configuring-ssl/index.html">Configuring SSL</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/bucket-shadowing/index.html">Bucket Shadowing</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/sync-gateway/accelerator.html">Accelerator</a>
                  
                
                
              </li>
              
            </ul>
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../guides/authentication/index.html">Authentication</a>
              
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/authentication/basic-authentication/index.html">Basic Authentication</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/authentication/openid/index.html">OpenID Connect</a>
                  
                
                
                <ul>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/authentication/openid/configuration-options/index.html">Configuration Options</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/authentication/openid/advanced-topics/index.html">Advanced Topics</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/authentication/openid/google/index.html">How-To: Google</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../guides/authentication/openid/active-directory/index.html">How-To: Active Directory</a>
                      
                    
                    
                  </li>
                  
                </ul>
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/authentication/custom-authentication/index.html">Custom Authentication</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../guides/authentication/static-providers/index.html">Static Providers</a>
                  
                
                
              </li>
              
            </ul>
            
          </li>
          
        </ul>
      
      </li>
    
      <li class="isexpanded open ">
      
        
          <a href="../../../../references/index.html">API References</a>
        
      
      
        <ul>
          
          <li class=" ">
            
              
                <a href="../../../../references/couchbase-lite/index.html">Couchbase Lite</a>
              
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../references/couchbase-lite/couchbase-lite/index.html">Native API</a>
                  
                
                
                <ul>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/manager/index.html">Manager</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/manager/manager/index.html">Manager</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/manager/manager-options/index.html">ManagerOptions</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/manager/database-options/index.html">DatabaseOptions</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/database/index.html">Database</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/database/database/index.html">Database</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/database/validation-context/index.html">ValidationContext</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/document/index.html">Document</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/document/document/index.html">Document</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/document/document-change/index.html">Document Change</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/revision/index.html">Revision</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/revision/revision/index.html">Revision</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/revision/saved-revision/index.html">Saved Revision</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/revision/unsaved-revision/index.html">Unsaved Revision</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/attachment/index.html">Attachment</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/attachment/attachment/index.html">Attachment</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/view/index.html">View</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/view/view/index.html">View</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/view/view-compiler/index.html">View Compiler</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/query/index.html">Query</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/query/query/index.html">Query</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/query/live-query/index.html">Live Query</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/query/query-enumerator/index.html">QueryEnumerator</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/query/query-row/index.html">QueryRow</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/couchbase-lite/replication/index.html">Replication</a>
                      
                    
                    
                    <ul>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/replication/replication/index.html">Replication</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/replication/authenticator/index.html">Authenticator</a>
                          
                        
                        
                      </li>
                      
                      <li class=" ">
                        
                          
                          <a href="../../../../references/couchbase-lite/couchbase-lite/replication/authenticator-factory/index.html">AuthenticatorFactory</a>
                          
                        
                        
                      </li>
                      
                    </ul>
                    
                  </li>
                  
                </ul>
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../references/couchbase-lite/rest-api/index.html">REST API</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../references/couchbase-lite/release-notes/index.html">Release notes</a>
                  
                
                
                <ul>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/release-notes/iOS/index.html">iOS</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/release-notes/Java/index.html">Java</a>
                      
                    
                    
                  </li>
                  
                  <li class=" ">
                    
                      
                      <a href="../../../../references/couchbase-lite/release-notes/Dot-Net/index.html">.NET</a>
                      
                    
                    
                  </li>
                  
                </ul>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class=" ">
            
              
                <a href="../../../../references/sync-gateway/index.html">Sync Gateway</a>
              
            
            
            <ul>
              
              <li class=" ">
                
                  
                    <a href="../../../../references/sync-gateway/rest-api/index.html">Public REST API</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../references/sync-gateway/admin-rest-api/index.html">Admin REST API</a>
                  
                
                
              </li>
              
              <li class=" ">
                
                  
                    <a href="../../../../references/sync-gateway/release-notes/index.html">Release notes</a>
                  
                
                
              </li>
              
            </ul>
            
          </li>
          
        </ul>
      
      </li>
    
  </ul>
</nav>
            </div>
          </nav>
        </aside>
        <div class="col four-fifths article">
          <div class="story">
            <div class="body">
              
              
              
              <!-- Do not import the overridden styles on swagger ui pages -->
              
              <link rel="stylesheet" type="text/css" href="https://couchbase-docs.s3.amazonaws.com/mobile/assets/styles.css">
              
              
              
              <a class="edit-page-link" href="https://github.com/couchbaselabs/couchbase-mobile-portal/tree/master/md-docs/_1x/guides/couchbase-lite/native-api/view.md" target="_blank">Edit on GitHub</a>
              

              <div class="inner-content">
                <!-- Style API ref links -->
                <style>
                  a > code {
                    text-decoration: underline;
                    color: #0099e5;
                    background: #f5f7f7;
                    border-radius: 5px;
                    padding: 3px 6px;
                    margin: 0 1px;
                  }
                </style>
                <!-- Platform tabs -->
                <!-- TODO: Make visible when ready to show multi-platform training -->
                <div class="toggler">
                  <style>
                    .toggler a {
                      display: inline-block;
                      padding: 3px 20px;
                      margin: 2px;
                      border: 1px solid #00739c;
                      border-radius: 3px;
                      text-decoration: none !important;
                    }
                    .display-platform-ios .toggler .button-ios,
                    .display-platform-android .toggler .button-android,
                    .display-platform-rn .toggler .button-rn,
                    .display-platform-wpf .toggler .button-wpf,
                    .display-platform-csharp .toggler .button-csharp,
                    .display-platform-xam .toggler .button-xam,
                    .display-platform-swift .toggler .button-swift,
                    .display-platform-objc .toggler .button-objc,
                    .display-platform-java .toggler .button-java {
                      background-color: #00739c;
                      color: white;
                    }

                    block { display: none; }

                    .display-platform-ios .ios,
                    .display-platform-android .android,
                    .display-platform-rn .rn,
                    .display-platform-net .net,
                    .display-platform-csharp .csharp,
                    .display-platform-wpf .wpf,
                    .display-platform-xam .xam,
                    .display-platform-all .all,
                    .display-platform-swift .swift,
                    .display-platform-objc .objc,
                    .display-platform-java .java {
                      display: block;
                    }
                    .inner-content .inline:not(.tab-nav) {
                      display: none;
                    }
                    /* Must change the display mode for striped method names.
                       This works with the StripingTag Jekyll plugin. */
                    .display-platform-ios .ios.inline,
                    .display-platform-android .android.inline,
                    .display-platform-net .net.inline,
                    .display-platform-csharp .csharp.inline,
                    .display-platform-swift .swift.inline,
                    .display-platform-objc .objc.inline,
                    .display-platform-java .java.inline {
                      display: inline;
                    }
                  </style>
                  <div id="platform-tabs" class="hide">
                    <span>Platform:</span>
                    
                    <a href="javascript:void(0);" class="button-ios" onclick="display('platform', 'ios')">iOS</a>
                    <a href="javascript:void(0);" class="button-android" onclick="display('platform', 'android')">Android</a>
                    <a href="javascript:void(0);" class="button-wpf" onclick="display('platform', 'wpf')">WPF</a>
                    
                  </div>
                </div>
                <!-- SDK buttons -->
                <div id="swagger-libs" style="display: none;">
                  <span>Sync Gateway Public REST API:</span>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('java', 'public')">Java</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('csharp', 'public')">C#</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('go', 'public')">Go</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('python', 'public')">Python</a>
                  <br>
                  <span>Sync Gateway Admin REST API:</span>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('go', 'admin')">Go</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('python', 'admin')">Python</a>
                  <br>
                  <span>Couchbase Lite REST API:</span>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('java', 'lite')">Java</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('csharp', 'lite')">C#</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('swift', 'lite')">Swift</a>
                  <a href="javascript:void(0);" class="button" onclick="getSDK('python', 'lite')">Python</a>
                </div>
                <!-- Markdown content -->
                <p>A View is a persistent index of documents in a database, which you then query to find data. Couchbase Lite doesn&#39;t have a query language like SQL; instead, it uses a technique called map/reduce to generate indexes (views) according to arbitrary app-defined criteria. Queries can then look up a range of rows from a view, and either use the rows&#39; keys and values directly or get the documents they came from.</p>

<p>The main component of a view (other than its name) is its <strong>map function</strong>. This function is written in the same 
language as your 
appâmost likely Objective-C or Javaâso itâs very flexible. It takes a document&#39;s JSON as input, and <strong>emits</strong> (outputs) any number of key/value pairs to be indexed. The view generates a complete index by calling the map function on every document in the database, and adding each emitted key/value pair to the index, sorted by key. For example, a map function might grind through an address-book database and produce a set of mappings from names to phone numbers. The resulting index is persistent, and updated incrementally as documents change. (Itâs very much like the type of index a SQL database creates internally to optimize queries.)</p>

<p>A view may also have a <strong>reduce function</strong>. If present, it can be used during queries to combine multiple rows into 
one. It can be used to compute aggregate values like totals or averages, or to group rows by common criteria (like collecting all the artists in a record collection.) We&#39;ll explain reduce functions later on.</p>

<blockquote>
<p>Remember: <strong>a view is not a query, itâs an index.</strong> Views are persistent, and need to be updated (incrementally) whenever documents change, so having large numbers of them can be expensive. Instead, itâs better to have a smaller number of views that can be queried in interesting ways.</p>
</blockquote>
<h2><a class="anchor instructions" name="creating-and-initializing-views"></a>Creating and initializing views<a class="hash-link instructions" href="#creating-and-initializing-views"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p><code>View</code> objects belong to a <code>Database</code>. You create or find a view by calling the database&#39;s <code>viewNamed</code> method, which will create and return a new <code>View</code> if none exists by that name.</p>

<p>Even though a view is persistent, its map and reduce functions aren&#39;t: they&#39;re just function pointers (or blocks, or inner classes) and have to be registered at runtime, before the view is queried. It&#39;s good practice to set up views when your app starts up, right after opening the database:</p>

<div class="tabs"></div>
<div class="highlight"><span class="stripe-display objective-c"><pre><code class="language-c" data-lang="objective-c">// Create a view and register its map function:
CBLView* phoneView = [db viewNamed: @"phones"];
[view setMapBlock: MAPBLOCK({
    for (NSString* phone in doc[@"phones"]) {
        emit(phone, doc[@"name"]);
    }
}) version: @"2"];
</code></pre></span></div><div class="highlight"><span class="stripe-display swift"><pre><code class="language-swift" data-lang="swift">// Create a view and register its map function:
let phoneView = db.viewNamed("phones")
phoneView.setMapBlock({ (doc, emit) in
    if let phones = doc["phones"] as? [String] {
        for phone in phones {
            emit(phone, doc["name"])
        }
    }
}, version: "2")
</code></pre></span></div><div class="highlight"><span class="stripe-display android"><pre><code class="language-java" data-lang="java">// Create a view and register its map function:
View phoneView = database.getView("phones");
phoneView.setMap(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        List&lt;String&gt; phones = (List) document.get("phones");
        for (String phone : phones) {
            emitter.emit(phone, document.get("name"));
        }
    }
}, "2");
</code></pre></span><span class="stripe-display java"><pre><code class="language-java" data-lang="java">// Create a view and register its map function:
View phoneView = database.getView("phones");
phoneView.setMap(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        List&lt;String&gt; phones = (List) document.get("phones");
        for (String phone : phones) {
            emitter.emit(phone, document.get("name"));
        }
    }
}, "2");
</code></pre></span></div><div class="highlight"><span class="stripe-display c"><pre><code class="language-c" data-lang="c">// Create a view and register its map function:
var view = database.GetView("phones");
view.SetMap((doc, emit) =&gt;
{
    var phones = doc["phones"].AsList&lt;string&gt;();
    foreach(var phone in phones) 
    {
        emit(phone, doc["name"]);
    }
}, "2");
</code></pre></span></div>
<p>The <code>version</code> parameter to <code>setMapBlock</code> takes a bit of explanation. During development, and as you update the app, you may change the behavior of a map function. This invalidates any existing index generated by that function, so the next time the app runs, the view should rebuild the index from scratch using the new function. Unfortunately the view indexer can&#39;t tell that the map function has changed because it can&#39;t see its source code! Instead, you have to provide a version string that the indexer can compare, and you must change that string whenever you change the function. The easiest thing to remember is just to set the version to &quot;1&quot; initially, and then increment it every time you edit any source code in the map function (or any function of yours that it calls.)</p>
<h2><a class="anchor instructions" name="querying-views"></a>Querying views<a class="hash-link instructions" href="#querying-views"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2>
<p>You query a view by using a <code>Query</code> object that you create from a <code>View</code> by calling <code>createQuery</code>. This is a big topic, and is covered in a separate article on the <code>Query</code> class.</p>
<h2><a class="anchor instructions" name="map-functions"></a>Map functions<a class="hash-link instructions" href="#map-functions"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><h3><a class="anchor instructions" name="understanding-map-functions"></a>Understanding map functions<a class="hash-link instructions" href="#understanding-map-functions"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>As discussed in the introduction, a map function&#39;s job is to look at a document&#39;s JSON contents and from them produce (emit) zero or more key/value pairs to be indexed. If you know SQL, you can think of it as corresponding to the expressions that immediately follow the <code>SELECT</code> and <code>WHERE</code> keywords, only more powerful because you have the full power of a programming language available.</p>

<p>For discussion purposes, here&#39;s a simple map function in JavaScript:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"person"</span><span class="p">)</span>
        <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span> <span class="nx">doc</span><span class="p">[</span><span class="s2">"phone"</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<p>This function works with a database that contains, among other things, documents representing people, which are tagged with a <code>type</code> property whose value is &quot;<code>person</code>&quot;. (This use of a <code>type</code> property is a common idiom.) Every person document contains <code>name</code> and <code>phone</code> properties. The map function simply checks whether the document represents a person, and if it does, it calls <code>emit</code> to add the name and phone number to the index.</p>

<p>The resulting index maps names to phone numbers. You can query it to look up someone by name and find their phone number. You can also query it to get ranges of names, in alphabetical order, which is very useful for driving GUI list views.</p>
<h3><a class="anchor instructions" name="rules-for-the-map-function"></a>Rules for the map function<a class="hash-link instructions" href="#rules-for-the-map-function"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>The map function is called by the indexer to help generate an index, and it has to meet certain requirements, otherwise the index won&#39;t be consistent. It&#39;s important to understand some rules so you can create a proper map function, otherwise your queries can misbehave in strange ways.</p>

<ul>
<li><strong>It must be a &quot;<a href="https://en.wikipedia.org/wiki/Pure_function">pure</a>&quot; function:</strong> That means any time it&#39;s called with 
the same input, it must produce exactly the 
same 
output. In other words, it can&#39;t use any external state, just its input JSON.</li>
<li><strong>It can&#39;t have side effects:</strong> It shouldn&#39;t change any external state, because it&#39;s unpredictable when it&#39;s called
or 
how often it&#39;s called or in what order documents are passed to it.</li>
<li><strong>It must be thread-safe:</strong> It may be called on a background thread belonging to the indexer, or even in parallel on 
several threads at once.</li>
</ul>

<p>In particular, avoid these common mistakes:</p>

<ul>
<li>Don&#39;t do anything that depends on the current date and time -- that breaks the first rule, since your function&#39;s output can change depending on the date/time it&#39;s called. Common mistakes include emitting the current time as a timestamp, emitting a person&#39;s age, or emitting only documents that have been modified in the past week.</li>
<li>Don&#39;t try to &quot;parameterize&quot; the map function by referring to an external variable whose value you change when 
querying. It won&#39;t work. People sometimes try this because they want to find various subsets of the data, like all the items of a particular color. Instead, emit all the values of that property, and use a key range in the query to pick out the rows with the specific value you want.</li>
<li>Don&#39;t make any assumptions about when the map function is called. That&#39;s an implementation detail of the indexer. 
(For example, it&#39;s not called every time a document changes.)</li>
<li>Avoid having the map function call out into complex external code. That code might change later on to be stateful or
have side effects, breaking your map function.</li>
</ul>
<h3><a class="anchor instructions" name="keys-and-values"></a>Keys and values<a class="hash-link instructions" href="#keys-and-values"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>Both the key and value passed to <code>emit</code> can be any JSON-compatible objects: not just strings, but also numbers, booleans, arrays, dictionaries/maps, and the special JSON <code>null</code> object (which is distinct from a null/nil pointer.) In addition, the value emitted, but <em>not</em> the key, can be a null/nil pointer. (It&#39;s pretty 
common to not need a value in a view, in which case it&#39;s more efficient to not emit one.)</p>

<p>Keys are commonly strings, but it turns out that arrays are a very useful type of key as well. This is because of the way arrays are sorted: given two array keys, the first items are compared first, then if those match the second items are compared, and so on. That means that you can use array keys to establish 
multiple levels of sorting. If the map function emits keys of the form <em>[lastname, firstname]</em>, then the index will be sorted by last name, and entries with the same last name will be sorted by first name, just as if you&#39;d used <em>ORDER BY lastname, firstname</em> in SQL.</p>

<p>Here are the exact rules for sorting (collation) of keys. The most significant factor is the key&#39;s object type; keys of one type always sort before or after keys of a different type. This list gives the types in order, and states how objects of that type are compared:</p>

<ul>
<li>null</li>
<li>false, true (in that order)</li>
<li>Numbers, in numeric order of course</li>
<li>Strings, case-insensitive. The exact ordering is specified by the <a href="http://www.unicode.org/unicode/reports/tr10/">Unicode Collation Algorithm</a>. This is <strong>not</strong> the same as ASCII ordering, so the results might surprise you -- for example, all symbols, including &quot;~&quot;, sort before alphanumeric characters.</li>
<li>Arrays, compared item-by-item as described above.</li>
<li>Maps/dictionaries, also compared item-by-item. Unfortunately the order of items is ambiguous (since JSON doesn&#39;t specify any ordering of keys, and most implementations use hash tables which randomize the order) so using these as keys isn&#39;t recommended.</li>
</ul>
<h3><a class="anchor instructions" name="the-source-document-and-redirection"></a>The source document, and redirection<a class="hash-link instructions" href="#the-source-document-and-redirection"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>In addition to its key and value, every index row also remembers the ID of the document that emitted it. This can be accessed at query time via the <code>QueryRow.documentID</code> property, or more commonly via the shortcut <code>QueryRow.document</code> which uses the ID to load the Document object.</p>

<p>It can sometimes be useful to redirect this reference, i.e. to make the index row point to a different document instead. You do this by emitting a value that&#39;s a dictionary with a key <code>_id</code> whose value is the document ID you want the row to reference. The <code>QueryRow.documentID</code> and accessors will then use this document ID instead.</p>

<div class="tabs"></div>
<div class="highlight"><span class="stripe-display objective-c"><pre><code class="language-c" data-lang="objective-c">// This example indexes documents that record Facebook-style "likes".
// When querying, the document we really want to look at is the post being
// liked, so we redirect the emitted row at that document.
[view setMapBlock: MAPBLOCK({
    if ([doc[@"type"] isEqual: @"like"]) {
        NSString* associatedID = doc[@"likedPostID"];
        NSArray* key = @[doc[@"creator"], doc[@"date"]];
        NSDictionary* value = @{@"_id": associatedID};
        emit(key, value);
    }
}) version: @"1"];
</code></pre></span></div><div class="highlight"><span class="stripe-display swift"><pre><code class="language-swift" data-lang="swift">// This example indexes documents that record Facebook-style "likes".
// When querying, the document we really want to look at is the post being
// liked, so we redirect the emitted row at that document.
view.setMapBlock({ (doc, emit) -&gt; Void in
    if doc["type"] as? String == "like" {
        let associatedID = doc["likePostID"] as String
        let key = [doc["creator"]!, doc["date"]!]
        let value = ["_id": associatedID]
        emit(key, value)
    }
}, version: "1")
</code></pre></span></div><div class="highlight"><span class="stripe-display android"><pre><code class="language-java" data-lang="java">// This example indexes documents that record Facebook-style "likes".
// When querying, the document we really want to look at is the post being
// liked, so we redirect the emitted row at that document.
view.setMap(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        if (document.get("type").equals("like")) {
            String associatedID = (String) document.get("likedPostID");
            List&lt;Object&gt; key = new ArrayList&lt;Object&gt;();
            key.add(document.get("creator"));
            key.add(document.get("date"));
            HashMap&lt;String, Object&gt; value = new HashMap&lt;String, Object&gt;();
            value.put("_id", associatedID);
            emitter.emit(key, value);
        }
    }
}, "1");
</code></pre></span><span class="stripe-display java"><pre><code class="language-java" data-lang="java">// This example indexes documents that record Facebook-style "likes".
// When querying, the document we really want to look at is the post being
// liked, so we redirect the emitted row at that document.
view.setMap(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        if (document.get("type").equals("like")) {
            String associatedID = (String) document.get("likedPostID");
            List&lt;Object&gt; key = new ArrayList&lt;Object&gt;();
            key.add(document.get("creator"));
            key.add(document.get("date"));
            HashMap&lt;String, Object&gt; value = new HashMap&lt;String, Object&gt;();
            value.put("_id", associatedID);
            emitter.emit(key, value);
        }
    }
}, "1");
</code></pre></span></div><div class="highlight"><span class="stripe-display c"><pre><code class="language-c" data-lang="c">No code example is currently available.
</code></pre></span></div>
<p>Even if you&#39;ve used the redirect technique, at query time you can still recover the ID of the actual document that emitted the row, by using the <code>QueryRow.sourceDocumentID</code> property.</p>
<h2><a class="anchor instructions" name="reduce-functions"></a>Reduce functions<a class="hash-link instructions" href="#reduce-functions"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><h3><a class="anchor instructions" name="understanding-reduce-functions"></a>Understanding reduce functions<a class="hash-link instructions" href="#understanding-reduce-functions"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>Reduce functions are the other half of the map/reduce technique. They&#39;re optional, and less commonly used. A reduce function post-processes the indexed key/value pairs generated by the map function, by aggregating the values together. Very commonly it counts them, or (if the values are numeric) totals or averages them. The reduce function boils down data the way a chef reduces a sauce. Or if you&#39;re a SQL user, reduce functions are like SQL aggregation operators like <code>COUNT</code> or <code>AVERAGE</code> (only you get to define your own.)</p>

<p>In general, most views don&#39;t need reduce functions, so don&#39;t feel like you&#39;re missing something if you haven&#39;t written one. But if you find yourself writing a query and counting the returned rows or adding up their values, you could do that more efficiently with a reduce function.</p>

<p><strong>A reduce function takes an ordered list of key/value pairs, aggregates them together into a single object, and 
returns that object.</strong> Here&#39;s an example, building on the phone-numbers example up above:</p>

<div class="tabs"></div>
<div class="highlight"><span class="stripe-display objective-c"><pre><code class="language-c" data-lang="objective-c">// Create a view and register its map and reduce functions:
CBLView* phoneView = [db viewNamed: @"phones"];
[view setMapBlock: MAPBLOCK({
    for (NSString* phone in doc[@"phones"]) {
        emit(phone, doc[@"name"]);
    }
}) reduceBlock:^id(NSArray *keys, NSArray *values, BOOL rereduce) {
    return @(values.count);
} version: @"2"];
</code></pre></span></div><div class="highlight"><span class="stripe-display swift"><pre><code class="language-swift" data-lang="swift">let phoneView = db.viewNamed("phones")
phoneView.setMapBlock({ (doc, emit) -&gt; Void in
    if let phones = doc["phones"] as? [String] {
        for phone in phones {
            emit(phone, doc["name"])
        }
    }
}, reduceBlock: { (keys, values, rereduce) -&gt; AnyObject! in
    return values.count
}, version: "2")
</code></pre></span></div><div class="highlight"><span class="stripe-display android"><pre><code class="language-java" data-lang="java">// Create a view and register its map and reduce functions:
View phoneView = database.getView("phones");
phoneView.setMapReduce(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        List&lt;String&gt; phones = (List) document.get("phones");
        for (String phone : phones) {
            emitter.emit(phone, document.get("name"));
        }
    }
}, new Reducer() {
    @Override
    public Object reduce(List&lt;Object&gt; keys, List&lt;Object&gt; values, boolean rereduce) {
       return new Integer(values.size());
    }
}, "2");
</code></pre></span><span class="stripe-display java"><pre><code class="language-java" data-lang="java">// Create a view and register its map and reduce functions:
View phoneView = database.getView("phones");
phoneView.setMapReduce(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        List&lt;String&gt; phones = (List) document.get("phones");
        for (String phone : phones) {
            emitter.emit(phone, document.get("name"));
        }
    }
}, new Reducer() {
    @Override
    public Object reduce(List&lt;Object&gt; keys, List&lt;Object&gt; values, boolean rereduce) {
       return new Integer(values.size());
    }
}, "2");
</code></pre></span></div><div class="highlight"><span class="stripe-display c"><pre><code class="language-c" data-lang="c">// Create a view and register its map and reduce functions:
var view = database.GetView("phones");
view.SetMapReduce((doc, emit) =&gt; 
{
    var phones = doc["phones"].AsList&lt;string&gt;();
    foreach(var phone in phones) 
    {
        emit(phone, doc["name"]);
    }
}, (keys, values, rereduce) =&gt; values.ToList().Count, "2.0");
</code></pre></span></div>
<p>For efficiency, the key/value pairs are passed in as two parallel arrays. This reduce block just counts the number of values and returns that number as an object. We could query this view, with reduce enabled, and get the total number of phone numbers in the database. Or by specifying a key range we could find the number of phone numbers in that range, for example the number in a single area code.</p>

<p>Here&#39;s just the body of a reduce function that totals up numbers. (This function would belong in a different view, whose map function emitted numeric values.)</p>

<div class="tabs"></div>
<div class="highlight"><span class="stripe-display objective-c"><pre><code class="language-c" data-lang="objective-c">double total = 0;
for (NSNumber* value in values) {
    total += value.doubleValue;
}
return @(total);
</code></pre></span></div><div class="highlight"><span class="stripe-display swift"><pre><code class="language-swift" data-lang="swift">var total: Double = 0.0
let numberValues = values as [Double];
for value in numberValues {
    total += value
}
return total
</code></pre></span></div><div class="highlight"><span class="stripe-display android"><pre><code class="language-java" data-lang="java">double total = 0;
for (Double value : values) {
    total += value.doubleValue();
}
return new Double(total);
</code></pre></span><span class="stripe-display java"><pre><code class="language-java" data-lang="java">double total = 0;
for (Double value : values) {
    total += value.doubleValue();
}
return new Double(total);
</code></pre></span></div><div class="highlight"><span class="stripe-display c"><pre><code class="language-c" data-lang="c">var total = 0.0;
foreach(var value in values.ToList())
{
    total += Convert.ToDouble(value);
}
return total;
</code></pre></span></div>
<p>This totaling is common enough that <code>CBLView</code> provide a utility to do it for you, the <code>totalValues</code> method.</p>
<h3><a class="anchor instructions" name="rereducing"></a>Rereducing<a class="hash-link instructions" href="#rereducing"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>The previous section ignored the boolean <code>rereduce</code> parameter that&#39;s passed to the reduce function. What&#39;s it for? Unfortunately, from your perspective as a reduce-function-writer it&#39;s just there to make your job a bit harder. The reason it exists is because it&#39;s part of a major optimization that makes reducing more efficient for the query engine.</p>

<p>Think of a view with a hundred million rows in its index. To run a reduced query against the whole index (with no startKey or endKey) the database will have to read all hundred million keys and values into memory at once, so it can pass them all to your reduce function. That&#39;s a lot of overhead, and on a mobile device it&#39;s likely to crash your app.</p>

<p>Instead, the database will read the rows in chunks. It&#39;ll read some number of rows into memory, send them to your reduce function, release them from memory, then go on to the next rows. This scales very well, but now there&#39;s the problem of what to do with the multiple reduced values returned by your function. Reducing is supposed to produce one end result, not several! The answer is to reduce the list of reduced values -- to <code>re-reduce</code>.</p>

<p>The rereduce parameter is there to tell your reduce function that it&#39;s being called in this special <code>re-reduce mode</code>. <strong>When re-reducing there are no keys, and the values are the ones already returned by previous runs of the same reduce function.</strong> The function&#39;s job is, once again, to combine the values into a single 
value and return it.</p>

<p>Sometimes you can handle re-reduce mode exactly like reduce mode. The second reduce block shown above (the one that totals up the values) can do this. Since its input values are numbers, and its output is a number, the re-reduce is done the same way as the reduce, and it can just ignore the <code>rereduce</code> flag.</p>

<p>But sometimes re-reduce has to work differently, because the output of the reduce stage doesn&#39;t look like the indexed values. The first reduce example -- the one that just counts the rows -- is an example. To re-reduce a list of row counts, you can&#39;t just count them, you have to add them. Let&#39;s revisit that example and add proper support for re-reducing:</p>

<div class="tabs"></div>
<div class="highlight"><span class="stripe-display objective-c"><pre><code class="language-c" data-lang="objective-c">// Create a view and register its map and reduce functions:
CBLView* phoneView = [db viewNamed: @"phones"];
[view setMapBlock: MAPBLOCK({
    for (NSString* phone in doc[@"phones"]) {
        emit(phone, doc[@"name"]);
    }
}) reduceBlock:^id(NSArray *keys, NSArray *values, BOOL rereduce) {
    if (rereduce) {
        return [CBLView totalValues: values];  // re-reduce mode adds up counts
    } else {
        return @(values.count);
    }
}) version: @"2"];
</code></pre></span></div><div class="highlight"><span class="stripe-display swift"><pre><code class="language-swift" data-lang="swift">// Create a view and register its map and reduce functions:
let phoneView = db.viewNamed("phones")
phoneView.setMapBlock({ (doc, emit) in
    if let phones = doc["phones"] as? [String] {
        for phone in phones {
            emit(phone, doc["name"])
        }
    }
}, reduceBlock: { (keys, values, rereduce) in
    if rereduce {
        return CBLView.totalValues(values) // re-reduce mode adds up counts
    } else {
        return values.count
    }
}, version: "2")
</code></pre></span></div><div class="highlight"><span class="stripe-display android"><pre><code class="language-java" data-lang="java">// Create a view and register its map and reduce functions:
View phoneView = database.getView("phones");
phoneView.setMapReduce(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        List&lt;String&gt; phones = (List) document.get("phones");
        for (String phone : phones) {
            emitter.emit(phone, document.get("name"));
        }
    }
}, new Reducer() {
    @Override
    public Object reduce(List&lt;Object&gt; keys, List&lt;Object&gt; values, boolean rereduce) {
        if (rereduce) {
            return View.totalValues(values);
        } else {
            return new Integer(values.size());
        }
    }
}, "2");
</code></pre></span><span class="stripe-display java"><pre><code class="language-java" data-lang="java">// Create a view and register its map and reduce functions:
View phoneView = database.getView("phones");
phoneView.setMapReduce(new Mapper() {
    @Override
    public void map(Map&lt;String, Object&gt; document, Emitter emitter) {
        List&lt;String&gt; phones = (List) document.get("phones");
        for (String phone : phones) {
            emitter.emit(phone, document.get("name"));
        }
    }
}, new Reducer() {
    @Override
    public Object reduce(List&lt;Object&gt; keys, List&lt;Object&gt; values, boolean rereduce) {
        if (rereduce) {
            return View.totalValues(values);
        } else {
            return new Integer(values.size());
        }
    }
}, "2");
</code></pre></span></div><div class="highlight"><span class="stripe-display c"><pre><code class="language-c" data-lang="c">// Create a view and register its map and reduce functions:
let phoneView = database.GetView("phones");
phoneView.SetMapReduce((doc, emit) =&gt;
{
    var phones = doc["phones"].AsList&lt;string&gt;();
    foreach(var phone in phones) 
    {
        emit(phone, doc["name"]);
    }
}, (keys, values, rereduce) =&gt; {
    if (rereduce) 
    {
        return View.TotalValues(values.ToList());
    } 
    else 
    {
        return values.ToList().Count;
    }
}, "2.0");
</code></pre></span></div>
<p>When the <code>rereduce</code> flag is off, this just counts the raw values as before. But when the flag is on, it knows it&#39;s been given an array of row counts, so it invokes the <code>totalValues</code> method to add them up.</p>

<p>Now that you know how re-reduce works, we should let you know <strong>that Couchbase Lite 1.0 doesn&#39;t actually use re-reduce</strong> -- your reduce function will always be given index rows, never already-reduced values. The <code>rereduce</code> parameter is in the API for future expansion, because in the future Couchbase Lite will use it. For now, it&#39;s up to you whether you want to ignore re-reduce (and maybe find that your reduce function breaks in the future) or code defensively and implement it now even though it isn&#39;t used yet.</p>
<h3><a class="anchor instructions" name="rules-for-the-reduce-function"></a>Rules for the reduce function<a class="hash-link instructions" href="#rules-for-the-reduce-function"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p>The reduce function has the same restrictions as the map function (see above): It must be a &quot;pure&quot; function that always produce the same output given the same input. It must not have side effects. And it must be thread-safe. In addition:</p>

<ul>
<li><strong>Its output should be no larger than its input.</strong> Usually this comes naturally. But it is legal to return an array
or dictionary, and sometimes people have tried to make reduce functions that transform the input values without actually making them any smaller. The problem with this is that it scales badly, and as the size of the index grows, the indexer will eventually run out of memory and fail.</li>
</ul>
<h2><a class="anchor instructions" name="development-considerations"></a>Development considerations<a class="hash-link instructions" href="#development-considerations"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><h3><a class="anchor instructions" name="map-function-design"></a>Map function design<a class="hash-link instructions" href="#map-function-design"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p><strong>When to emit a whole document as the value?</strong> In some places you&#39;ll see code that does something like <code>emit(key, doc)</code>
, i.e. emitting the document&#39;s entire body as
 the value. (Some people seem to do this by reflex whenever they don&#39;t have a specific value in mind.) It&#39;s not necessarily bad, but most of the time you shouldn&#39;t do it. The benefit is that, by having the document&#39;s properties right at hand when you process a query row, it can make querying a little bit faster (saving a trip to the database to load the document.) But the downside is that it makes the view index a lot larger, which can make querying slower. So whether it&#39;s a net gain or loss depends on the specific use case. We recommend that you just set the value to <code>null</code> if you don&#39;t need to emit any specific value.</p>

<p><strong>Is it OK is the same key is emitted more than once?</strong> The index allows duplicate keys, whether emitted by the same 
document or different documents. A query will return all of those key/value pairs if they match. They&#39;ll be sorted by the ID of the document that was responsible for emitting them; if a doc emits the same key multiple times, the order is undefined.</p>

<p><strong>When is the map function called?</strong> View indexes are updated on demand when queried. So after a document changes, the
 next query made to a view will 
cause that view&#39;s map function to be called on the doc&#39;s new contents, updating the view index. (But remember that you shouldn&#39;t write any code that makes assumptions about when map functions are called.)</p>

<p><strong>If a document has conflicts, which conflicting revision gets indexed?</strong> The document&#39;s <code>currentRevision</code>, sometimes 
called the &quot;winning&quot; revision, is the one that you see in the API if you 
don&#39;t request a revision by ID.</p>
<h3><a class="anchor instructions" name="performance"></a>Performance<a class="hash-link instructions" href="#performance"><svg aria-hidden="true" class="octicon octicon-link" height="20" version="1.1" viewBox="0 -3 20 20" width="20"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3>
<p><strong>How to improve your view indexing:</strong> The main thing you have control over is the performance of your map function, 
both how long it takes to run and how many objects it allocates. Try profiling your app while the view is indexing and see if a lot of time is spent in the map function; if so, optimize it. See if you can short-circuit the map function and give up early if the document isn&#39;t a type that will produce any rows. Also see if you could emit less data. (If you&#39;re emitting the entire document as a value, don&#39;t.)</p>

                <!-- Logic to make all links open in a new tab -->
                <script>
                  var links = document.links;

                  for (var i = 0, linksLength = links.length; i < linksLength; i++) {
                    if (['button-swift', 'button-objc', 'button-csharp', 'button-java', 'button-ios', 'button-android', 'button-wpf'].indexOf(links[i].className) == -1) {
                      if (links[i].hostname != window.location.hostname) {
                        links[i].target = '_blank';
                      }
                    }
                  }
                </script>
                <!-- Logic for platform tabs -->
                <script>
                  // Only show on Develop pages
                  var blocksv1 = document.getElementsByClassName('ios');
                  var blocksv2 = document.getElementsByClassName('swift');
                  if ((blocksv1.length > 0 && blocksv1[0].tagName == 'BLOCK') || (blocksv2.length > 0 && blocksv2[0].tagName == 'BLOCK')) {
                    var platformTabs = document.getElementById('platform-tabs');
                    platformTabs.className = "show";
                  }
                  // Convert <div>...<span><block /></span>...</div>
                  // Into <div>...<block />...</div>
                  var blocks = document.getElementsByTagName('block');
                  for (var i = 0; i < blocks.length; ++i) {
                    // Ignore blocks that have the inline class name.
                    if (blocks[i].className.indexOf('inline') == -1) {
                      var block = blocks[i];
                      var span = blocks[i].parentNode;
                      var container = span.parentNode;
                      container.insertBefore(block, span);
                      container.removeChild(span);
                    }
                  }
                  // Convert <div>...<block />content<block />...</div>
                  // Into <div>...<block>content</block><block />...</div>
                  blocks = document.getElementsByTagName('block');
                  for (var i = 0; i < blocks.length; ++i) {
                    // Ignore blocks that have the inline class name.
                    if (blocks[i].className.indexOf('inline') == -1) {
                      var block = blocks[i];
                      while (block.nextSibling && block.nextSibling.tagName !== 'BLOCK') {
                        block.appendChild(block.nextSibling);
                      }
                    }
                  }
                  function display(type, value, isFirstPageLoad) {
                    deleteCookie('mobile-lang');
                    setCookie('mobile-lang', value, 365);
                    if (!isFirstPageLoad) {
                      var newurl = UpdateQueryString('language', value);
                      window.history.pushState({path: newurl}, '', newurl);
                    }
                    // Place the display-platform-* class on div.inner-content
                    var container = document.getElementsByClassName('inner-content')[0];
                    container.className = 'inner-content display-' + type + '-' + value;
                    if (value == 'wpf' || value == 'csharp' || value == 'xam') {
                      container.className += ' display-platform-net';
                    }
                    container.className += ' display-platform-all';
                    return false;
                  }

                  // If we are coming to the page with a hash in it (i.e. from a search, for example), try to get
                  // us as close as possible to the correct platform and dev os using the hashtag and block walk up.
                  var foundHash = false;
                  var language = getParameterByName('language');
                  if (['ios', 'android', 'csharp', 'swift', 'objc', 'wpf', 'java'].indexOf(language) > -1) {
                    foundHash = true;
                    display('platform', language, true);
                  }

                  if (!foundHash) {
                    var cookie_lang = getCookie('mobile-lang');
                    if (document.getElementsByClassName(cookie_lang).length > 0) {
                      display('platform', cookie_lang, true);
                    } else {
                      if (document.getElementsByClassName('swift').length > 0) {
                        display('platform', 'swift', true);
                      } else if (document.getElementsByClassName('ios').length > 0) {
                        display('platform', 'ios', true);
                      }
                    }
                  }

                  function getParameterByName(name, url) {
                    if (!url) {
                      url = window.location.href;
                    }
                    name = name.replace(/[\[\]]/g, "\\$&");
                    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                      results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                  }
                  function setCookie(cname, cvalue, exdays) {
                    var d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    var expires = "expires="+d.toUTCString();
                    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
                  }
                  function deleteCookie(cname) {
                    document.cookie = cname + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
                  }
                  function getCookie(cname) {
                    var name = cname + "=";
                    var decodedCookie = decodeURIComponent(document.cookie);
                    var ca = decodedCookie.split(';');
                    for(var i = 0; i <ca.length; i++) {
                      var c = ca[i];
                      while (c.charAt(0) == ' ') {
                        c = c.substring(1);
                      }
                      if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                      }
                    }
                    return "";
                  }
                  function UpdateQueryString(key, value, url) {
                    if (!url) url = window.location.href;
                    var re = new RegExp("([?&])" + key + "=.*?(&|#|$)(.*)", "gi"),
                      hash;

                    if (re.test(url)) {
                      if (typeof value !== 'undefined' && value !== null)
                        return url.replace(re, '$1' + key + "=" + value + '$2$3');
                      else {
                        hash = url.split('#');
                        url = hash[0].replace(re, '$1$3').replace(/(&|\?)$/, '');
                        if (typeof hash[1] !== 'undefined' && hash[1] !== null)
                          url += '#' + hash[1];
                        return url;
                      }
                    }
                    else {
                      if (typeof value !== 'undefined' && value !== null) {
                        var separator = url.indexOf('?') !== -1 ? '&' : '?';
                        hash = url.split('#');
                        url = hash[0] + separator + key + '=' + value;
                        if (typeof hash[1] !== 'undefined' && hash[1] !== null)
                          url += '#' + hash[1];
                        return url;
                      }
                      else
                        return url;
                    }
                  }
                </script>
                <!-- Segment.io analytics -->
                <script type="text/javascript">
                  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
                    analytics.load("8mPwsJfsKAal6r62qS9ubBQqjWwYly4M");
                    analytics.page()
                  }}();
                </script>
                <script>
                  var starterProject = document.getElementById('project');
                  analytics.trackLink(starterProject, 'Download project', {
                    category: 'Training',
                    label: 'Swift'
                  });
                </script>
                <!-- SDK buttons (shown only if show_true=true in the SDK) -->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.min.js"></script>
                <script>

                  if (getParameterByName("show_swagger_libs") || getParameterByName("swagger")) {
                    var swagger_libs_el = document.getElementById('swagger-libs');
                    swagger_libs_el.style.display = 'block';
                  }

                  function getSDK(lang, spec) {
                    var url = null;
                    switch(spec) {
                      case 'public':
                        url = 'http://developer.couchbase.com/mobile/swagger/sync-gateway-public/spec.json';
                        break;
                      case 'admin':
                        url = 'http://developer.couchbase.com/mobile/swagger/sync-gateway-admin/spec.json';
                        break;
                      case 'lite':
                        url = 'http://developer.couchbase.com/mobile/swagger/couchbase-lite/spec.json';
                        break;
                    }
                    fetch(url)
                      .then(function (res) {
                        return res.json();
                      })
                      .then(function (res) {
                        var options = {
                          method: 'POST',
                          headers: {
                            'Content-Type': 'application/json'
                          },
                          body: JSON.stringify({spec: res})
                        };
                        return fetch('http://generator.swagger.io/api/gen/clients/' + lang, options)
                      })
                      .then(function (res) {
                        return res.json();
                      })
                      .then(function (res) {
                        window.location = res.link;
                      });
                  }

                  function getParameterByName(name, url) {
                    if (!url) url = window.location.href;
                    name = name.replace(/[\[\]]/g, "\\$&");
                    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                      results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                  }
                </script>
              </div>

              <script>
                /**
                 * HACK: To keep the code tabs while using markdown. Insert <div class="tab"></div> in the markdown and this script
                 * finds and replaces all instances with a tab bar.
                 */
                var tab_bar_html = "</div><a href='javascript:setLanguage(\"swift\")' class=\"tab stripe-active swift\">Swift</a> <a href='javascript:setLanguage(\"objective-c\")' class=\"tab stripe-active objective-c selected\">Objective-C</a> <a href='javascript:setLanguage(\"android\")' class=\"tab stripe-active android\">Android</a> <a href='javascript:setLanguage(\"java\")' class=\"tab stripe-active java\">Java</a> <a href='javascript:setLanguage(\"c\")' class=\"tab stripe-active c\">C#</a>"
                var tab_bars = document.getElementsByClassName('tabs');
                var i = tab_bars.length - 1;
                while (i >= 0) {
                  var parent = tab_bars.item(i).parentNode;
                  var element = document.createElement('div');
                  element.className = 'tab-bar';
                  element.innerHTML = tab_bar_html;
                  parent.replaceChild(element, tab_bars.item(i));
                  i--;
                }

                /**
                 * HACK: To keep the markdown tables styles after ingestion we need to wrap the ouput in <div class="table"></div>
                 */
                var tables = document.getElementsByTagName("table");
                var j = tables.length - 1;
                while (j >= 0) {
                  var parent = tables.item(j).parentNode;
                  var table = tables.item(j);
                  var wrapper = document.createElement('div');
                  wrapper.className = 'table';
                  wrapper.style.padding = 0;
                  parent.insertBefore(wrapper, table);
                  wrapper.appendChild(table);
                  j--;
                }
              </script>
              <script>
                /**
                 * Hack to not open some list titles
                 */
                (function() {
                  var els = document.getElementsByClassName('static');
                  for (var i = 0; i < els.length; i++) {
                    (function() {
                      var el = els[i];
                      el.onclick = function () {
                        var icon = el.previousSibling;
                        var iconClasses = icon.className;
                        if (iconClasses == 'icon') {
                          icon.className = 'icon close';
                        } else {
                          icon.className = 'icon';
                        }
                        var list = el.nextSibling;
                        var displayProp = list.style.display;
                        if (displayProp == 'block') {
                          list.style.display = 'none';
                        } else {
                          list.style.display = 'block';
                        }
                      }
                    })()
                  }
                })()
              </script>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section>
  
</main>
  </div>
</div>

<!-- Require_js bootstrap for app-specific JS module support -->
<!-- data-main attribute tells require.js to load
scripts/main.js after require.js loads. -->
<script type="text/javascript" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/require.js"></script>
<script type="text/javascript" src="https://developer.couchbase.com/webfiles/1498186094252/js/thirdparty/vendor/prism.js"></script>
<script rel="main" type="text/javascript" src="https://developer.couchbase.com/webfiles/1498186094252/js/main.js" ></script>
<!-- leave the main attribute, it is used to help main.js determine -->
<!-- the domain-relative path to the base script (main.js) -->

</body>

</html>